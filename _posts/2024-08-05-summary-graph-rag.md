---
layout: single
title: (요약)로컬에서 글로벌로 - 질문 중심 요약을 위한 Graph RAG 접근법
date: 2024-07-25 21:00
categories: 
  - llm 
tags: 
   - LLM
   - Graph RAG
excerpt : Microsoft 직원이 게재한 Graph RAG 논문을 요약하였습니다.
header : 
  teaser: /assets/images/blog/ai1.jpg
  overlay_image: /assets/images/blog/ai1.jpg
toc : true  
toc_sticky: true
---

## 들어가며

본 블로그에서는 Google의 Notebook LM 도구를 사용하여 Graph RAG관련 기술 논문에 대해서 요약 작업을 하였습니다. 
 
- 논문 제목 : From Local to Global: A Graph RAG Approach to Query-Focused Summarization
- 파일 원본 : <https://arxiv.org/pdf/2404.16130>{:_target="_blank"}

> 논문 원본과 다르게 설명을 위하여 부가적인 내용이 포함되어 있을수 있습니다. 상세한 내용은 논문 원본을 참고하시기 바랍니다.

## Graph RAG, 대규모 문서 이해의 핵심 기술

### 서론 

오늘날 IT 전문가들은 그 어느 때보다 방대한 데이터 속에서 의미 있는 정보를 신속하게 추출하고 분석해야 하는 과제에 직면해 있습니다. 이러한 요구에 부응하여 최근 대규모 언어 모델(LLM) 기술을 기반으로 하는 혁신적인 정보 검색 및 분석 시스템들이 개발되고 있습니다. 그 중심에는 **Graph RAG**(Retrieval-Augmented Generation)가 있습니다. Graph RAG는 지식 그래프, RAG, 질문 중심 요약(QFS) 기술을 통합하여 기존 방식보다 월등한 문서 이해 능력을 제공하며, 방대한 텍스트 데이터에서 원하는 정보를 효율적으로 추출하고 분석할 수 있는 새로운 가능성을 제시합니다. 

### Graph RAG: 작동 방식 상세 설명 

Graph RAG는 LLM을 이용하여 입력 문서로부터 정보를 추출하고 이를 지식 그래프 형태로 구축하는 것에서 시작합니다.  

1. **문서 분할 및 요소 추출**: 입력 문서는 먼저 여러 개의 텍스트 청크로 분할됩니다.  이때 청크의 크기는 LLM의 컨텍스트 창 크기와 정보 추출의 정확도를 고려하여 결정됩니다.  각 텍스트 청크는 LLM에 입력되어 엔터티(예: 사람, 장소, 조직)와 엔터티 간의 관계를 추출합니다. LLM은 몇 가지 예시를 통해 특정 도메인에 맞는 엔터티와 관계를 추출하도록 학습될 수 있습니다. 또한, 추출 과정에서 누락된 엔터티를 찾기 위해 "gleaning"이라는 기법을 사용합니다. 이 기법은 LLM에게 누락된 엔터티가 있는지 질문하고, 있다면 다시 추출하도록 유도합니다. 

2. **지식 그래프 생성 및 커뮤니티 감지**: 추출된 엔터티와 관계는 지식 그래프 형태로 표현됩니다. 지식 그래프에서 엔터티는 노드로, 관계는 엣지로 표현됩니다.  Graph RAG는  Leiden 알고리즘과 같은 커뮤니티 감지 알고리즘을 사용하여 지식 그래프를 밀접하게 연결된 노드 그룹(커뮤니티)으로 분할합니다. 각 커뮤니티는 특정 주제 또는 개념과 관련된 정보를 나타냅니다. 예를 들어, 뉴스 기사 데이터셋에서 "영화", "배우", "감독"과 관련된 엔터티들은 하나의 커뮤니티로 묶일 수 있습니다.

3. **커뮤니티 요약**:  각 커뮤니티에 속하는 노드(엔터티) 및 엣지(관계) 정보는 LLM의 컨텍스트 창 크기에 맞춰 요약됩니다.  커뮤니티 요약은 계층적으로 구성될 수 있습니다. 최상위 레벨의 커뮤니티 요약은 데이터셋 전체에 대한 요약을 제공하며, 하위 레벨로 갈수록 특정 주제에 대한 상세한 정보를 담고 있습니다.  

4. **질문 답변 생성**: 사용자의 질문이 입력되면 Graph RAG는 먼저 질문과 관련된 커뮤니티를 찾습니다. 예를 들어, "어떤 영화들이 올해 영화제에서 수상했는가?"라는 질문이 들어오면 "영화제", "수상"과 관련된 커뮤니티를 찾아 해당 커뮤니티의 요약 정보를 LLM에 제공합니다. LLM은  커뮤니티 요약 정보들을 바탕으로 질문에 대한 답변을 생성합니다. 이때, 질문에 대한 답변은 여러 커뮤니티 요약들을 종합하여 생성될 수 있습니다. 

### Graph RAG의 이점 및 성능

Graph RAG는 기존의 RAG 방식에 비해 여러 가지 이점을 제공합니다.  Graph RAG는 기존 RAG에 비해 포괄성과 다양성 측면에서 뛰어난 성능을 보입니다.

* **향상된 포괄성**: Graph RAG는 지식 그래프를 사용하여 문서의 구조와 의미를 더욱 심층적으로 이해할 수 있습니다. 또한, 계층적인 커뮤니티 요약을 통해 답변 생성에 필요한 정보를 효율적으로 찾고 활용할 수 있습니다. 

* **다양한 관점 제공**: Graph RAG는 질문과 관련된 여러 커뮤니티 요약들을 종합하여 답변을 생성하기 때문에 다양한 관점과 정보를 제공할 수 있습니다. 

* **효율적인 정보 검색**:  Graph RAG가 특히 많은 질문을 처리해야 하는 경우에 효율적입니다. 특히, 최상위 레벨의 커뮤니티 요약만 사용하더라도 기존 RAG보다 뛰어난 성능을 보이며, 정보 검색에 필요한 토큰 수를 크게 줄일 수 있습니다.

### 결론 

 Graph RAG는 대규모 문서 이해의 핵심 기술로 부상하고 있으며,  정보 검색 및 분석, 질의응답 시스템, 문서 요약 등 다양한 분야에서 핵심적인 역할을 수행할 것으로 기대됩니다.  Graph RAG는 LLM과 지식 그래프 기술의 강력한 시너지를 보여주는 대표적인 사례이며, 앞으로 더욱 광범위한 분야에서 활용될 수 있는 잠재력을 가지고 있습니다. 

## 참고문서

- 논문 : <https://arxiv.org/pdf/2404.16130>{:_target="_blank"}
- MS에서 구현한 GraphRAG 파이썬 라이브러리 : <https://github.com/microsoft/graphrag>{:_target="_blank"}
- GraphRAG 테스트한 유트브 영상 : <https://www.youtube.com/watch?v=vX3A96_F3FU>{:_target="_blank"}
  - 동영상 내용중 : GraphRAG는 매우 유용하지만 실행 비용이 주요 문제가 될수 있습니다. 예를 들어, 특정 예제에서 GPT-4 요청을 포함하여 총 570회의 API 요청을 보냈으며, 처리된 토큰 수는 100만 개가 넘어 총 비용이 약 7달러가 되었습니다. 이는 대규모 데이터 코퍼스를 처리할 때 상당히 비쌀 수 있으므로 GraphRAG를 사용하기 전에 고려해야 할 중요한 요소입니다.